# Just Link Redirect Service

## Функционал 

### Описание алгоритма проброса параметров

Переход на другой адрес происходит с некоторым начальным набором параметров, который необходимо передать
на адрес перехода, предварительно его преобразовав.

Например. 

Есть настроенный редирект по пути redirect.com/kazino777.

Мы переходим по этому адресу со следующим набором параметров:

```
www.redirect.com/kazino777?utm_source=abc&utm_medium=xyz
```

При переходе нам необходимо попасть на 

```
www.kazino-777.ru/ak-47-dworf/xyz?src=abc
```

Как видно из примера, нам необходимо преобразовать набор изначальный параметров
`utm_source = abc, utm_medium = xyz` и адрес назнчачения `kazino777 -> www.kazino-777.ru/ak-47-dworf` 
в конечный адрес `www.kazino-777.ru/ak-47-dworf/xyz?src=abc`


Для этого надо задать правила маппинга параметров, которые привязываются не к конкретному адресу-назначению, а его
домену.


Как создать правило маппинга параметров для домена?

Для этого существует REST API

```
POST www.redirect.com/v1/api/param
```

а в тело запроса передать 

```json5
{
  "domain": "http://www.kazino-777.ru", // домен в формате URL
  "params": {
  // ключ является именем параметра адреса-источника, значение - адреса-назначения
    "utm_source": "src"
  }
}
```

Доступны следующие параметры для адрес-источника:

* utm_source
* utm_medium 
* utm_campaign
* utm_term 
* utm_keyword
* utm_content
* url

Если в теле запроса маппинга, в объекте `params`, какой-либо из описанных выше
параметров отсутствует, но этот параметр передается при переходе на адрес-источник,
 то он будет считать как путь, то есть его значение 
в адресе назначение будет записано как `/{значение параметра}`.

В продолжении нашего примера, алгоритм маппинга будет следующий:

1. Мы переходим по адресу 
`www.redirect.com/kazino777?utm_source=abc&utm_medium=xyz`
2. У нас в маппинге указано, что `utm_source = src`, следовательно, вместо параметра
`utm_source` будет передан параметр `src` с тем же значение, с `abc`.
3. У нас в маппинге не указан параметр `utm_medium`, но он задается при переходе и
поэтому он будет передан в виде относительного пути, а именно к адресу назначения
будет прибавлен путь со значение этого параметра, а именно `/xyz`
4. Остальные параметры у нас не указаны и не передаются на адрес-источник и поэтому
будут проигнорированы.

Применив этот алгоритм к адресу-источнику 
```
www.redirect.com/kazino777?utm_source=abc&utm_medium=xyz
```
и к созданному правилу маппинга и получим искомый результат:

```
www.kazino-777.ru/ak-47-dworf/xyz?src=abc
```